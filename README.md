# –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Ä–∞—Å—á–µ—Ç–æ–≤ —Å –ø–æ–º–æ—â—å—é Apache AirFlow

**–í—ã–ø–æ–ª–Ω–∏–ª–∞**: –°–º–∏—Ä–Ω–æ–≤–∞ –ê–Ω–∞—Å—Ç–∞—Å–∏—è

<hr>
 
## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```text
creating_and_normalazing_db/
‚îú‚îÄ‚îÄ üìÅ python_sripts/           # python-—Å–∫—Ä–∏–ø—Ç—ã
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ –°–º–∏—Ä–Ω–æ–≤–∞_–ê.–ú.py
‚îÇ‚îÄ‚îÄ üìÅ artifacts                # –°–∫—Ä–∏–Ω—à–æ—Ç—ã –∏–∑ Airflow
‚îú‚îÄ‚îÄ üìÑ README.md                # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

```

## –û–ø–∏—Å–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö

 <hr>

<details>
 
<summary><b>–¢–∞–±–ª–∏—Ü–∞ 'customer' —Å –ø–æ–ª—è–º–∏:</b></summary>

- `—Åustomer_id` -	ID –∫–ª–∏–µ–Ω—Ç–∞;
- `first_name` - –ò–º—è –∫–ª–∏–µ–Ω—Ç–∞;
- `last_name` -	–§–∞–º–∏–ª–∏—è –∫–ª–∏–µ–Ω—Ç–∞;
- `gender` -	–ü–æ–ª;
- `DOB` -	–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è;
- `job_title` -	–ü—Ä–æ—Ñ–µ—Å—Å–∏—è;
- `job_industry_category` -	–°—Ñ–µ—Ä–∞ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏;
- `wealth_segment` -	–°–µ–≥–º–µ–Ω—Ç –±–ª–∞–≥–æ—Å–æ—Å—Ç–æ—è–Ω–∏—è;
- `deceased_indicator` -	–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –∞–∫—Ç—É–∞–ª—å–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞;
- `owns_car` -	–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –Ω–∞–ª–∏—á–∏—è –∞–≤—Ç–æ–º–æ–±–∏–ª—è;
- `address` -	–ê–¥—Ä–µ—Å –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è;
- `postcode` -	–ü–æ—á—Ç–æ–≤—ã–π –∏–Ω–¥–µ–∫—Å;
- `state` -	–®—Ç–∞—Ç—ã;
- `country` -	–°—Ç—Ä–∞–Ω–∞ –ø—Ä–æ–∂–∏–≤–∞–Ω–∏—è;
- `property_valuation`	–û—Ü–µ–Ω–∫–∞ –∏–º—É—â–µ—Å—Ç–≤–∞.

</details>

<details>
 
<summary><b>–¢–∞–±–ª–∏—Ü–∞ 'product' —Å –ø–æ–ª—è–º–∏:</b></summary>

- `product_id` -	ID –ø—Ä–æ–¥—É–∫—Ç–∞;
- `brand` -	–ë—Ä–µ–Ω–¥;
- `product_line` -	–õ–∏–Ω–µ–π–∫–∞ –ø—Ä–æ–¥—É–∫—Ç–æ–≤;
- `product_class` -	–ö–ª–∞—Å—Å –ø—Ä–æ–¥—É–∫—Ç–∞;
- `product_size` -	–†–∞–∑–º–µ—Ä –ø—Ä–æ–¥—É–∫—Ç–∞;
- `list_price` -	–¶–µ–Ω–∞;
- `standard_cost` -	–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å.

</details>

<details>
 
<summary><b>–¢–∞–±–ª–∏—Ü–∞ 'orders' —Å –ø–æ–ª—è–º–∏:</b></summary>

- `order_id` -	ID —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏;
- `customer_id` -	ID –∫–ª–∏–µ–Ω—Ç–∞;
- `order_date` -	–î–∞—Ç–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏;
- `online_order` -	–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä –æ–Ω–ª–∞–π–Ω-–∑–∞–∫–∞–∑–∞;
- `order_status` -	–°—Ç–∞—Ç—É—Å —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏.

</details>

<details>
 
<summary><b>–¢–∞–±–ª–∏—Ü–∞ 'order_items' —Å –ø–æ–ª—è–º–∏:</b></summary>

- `order_item_id` -	ID –ø–æ–∑–∏—Ü–∏–∏ –≤ –∑–∞–∫–∞–∑–µ;
- `order_id` -	ID –∑–∞–∫–∞–∑–∞;
- `product_id` -	ID –ø—Ä–æ–¥—É–∫—Ç–∞;
- `quantity` -	–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–∞–Ω–Ω–æ–≥–æ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ –∑–∞–∫–∞–∑–µ;
- `item_list_price_at_sale` - –¶–µ–Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ –º–æ–º–µ–Ω—Ç –ø—Ä–æ–¥–∞–∂–∏;
- `item_standard_cost_at_sale` -	–°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø—Ä–æ–¥—É–∫—Ç–∞ –≤ –º–æ–º–µ–Ω—Ç –ø—Ä–æ–¥–∞–∂–∏.

</details>

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ DAG
 <hr>
 
**–û—Å–Ω–æ–≤–Ω—ã–µ —ç—Ç–∞–ø—ã –æ–±—Ä–∞–±–æ—Ç–∫–∏***:
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü (4 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Ç–∞—Å–∫–∞)

- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ CSV (4 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Ç–∞—Å–∫–∞)

- –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ —Ç–∞–±–ª–∏—Ü—ã product)

- –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∞–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ (2 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Ç–∞—Å–∫–∞)

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏
 <hr>

**–ù–∞–∑–≤–∞–Ω–∏–µ:** homework_mipt_6_dag

**–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ:** –ï–∂–µ–¥–Ω–µ–≤–Ω–æ (@daily)

**–ó–∞–ø—É—Å–∫:** –° –º–æ–º–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è

**Retry policy:** 1 –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç

**–ú–∞–∫—Å–∏–º—É–º –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö —Ç–∞—Å–∫–æ–≤:** 10

**EmailOperator –∑–∞–º–µ–Ω–µ–Ω –Ω–∞ Python-–∑–∞–≥–ª—É—à–∫—É**

## –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã:
 <hr>
- `PostgresOperator` - –¥–ª—è SQL –æ–ø–µ—Ä–∞—Ü–∏–π;

- `PythonOperator` - –¥–ª—è Python —Ñ—É–Ω–∫—Ü–∏–π;

- `BranchPythonOperator` - –¥–ª—è —É—Å–ª–æ–≤–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è;

- `DummyOperator` - –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏.

## –í—ã–ø–æ–ª–Ω—è–µ–º—ã–µ –∑–∞–¥–∞—á–∏
 <hr>

### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ):
   
`customer` - –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–æ–≤;

`product` - –¥–∞–Ω–Ω—ã–µ –ø—Ä–æ–¥—É–∫—Ç–æ–≤;

`orders` - –¥–∞–Ω–Ω—ã–µ –∑–∞–∫–∞–∑–æ–≤;

`order_items` - —Å–≤—è–∑—å –∑–∞–∫–∞–∑–æ–≤ –∏ –ø—Ä–æ–¥—É–∫—Ç–æ–≤.

### 2. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö (–ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ):
   
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—è CSV (, –∏–ª–∏ ;);

- –ü—Ä–∏–≤–µ–¥–µ–Ω–∏–µ –Ω–∞–∑–≤–∞–Ω–∏–π —Å—Ç–æ–ª–±—Ü–æ–≤ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É;

- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–æ–∫;

### 3. –û—á–∏—Å—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö:
   
- –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã `product_cor` —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ `product_id`;

- –£–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–∏–∫–∞—Ç–æ–≤, —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–∞–ø–∏—Å–µ–π —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Ü–µ–Ω–æ–π

### 4. –ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–ø—Ä–æ—Å—ã:
   
–ó–∞–ø—Ä–æ—Å 1: TOP-3 –∫–ª–∏–µ–Ω—Ç—ã –ø–æ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π —Å—É–º–º–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
```
sql
-- –ù–∞—Ö–æ–¥–∏—Ç 3 –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –∏ 3 —Å –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–π –æ–±—â–µ–π —Å—É–º–º–æ–π —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
-- –£—á–∏—Ç—ã–≤–∞–µ—Ç –∫–ª–∏–µ–Ω—Ç–æ–≤ –±–µ–∑ –∑–∞–∫–∞–∑–æ–≤ (—Å—É–º–º–∞ = 0)
-- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –∏–º—è, —Ñ–∞–º–∏–ª–∏—è, –æ–±—â–∞—è —Å—É–º–º–∞, —Ç–∏–ø (–º–∏–Ω–∏–º—É–º/–º–∞–∫—Å–∏–º—É–º)
```
–ó–∞–ø—Ä–æ—Å 2: TOP-5 –∫–ª–∏–µ–Ω—Ç–æ–≤ –ø–æ –¥–æ—Ö–æ–¥—É –≤ –∫–∞–∂–¥–æ–º —Å–µ–≥–º–µ–Ω—Ç–µ –±–ª–∞–≥–æ—Å–æ—Å—Ç–æ—è–Ω–∏—è

```
sql
-- –î–ª—è –∫–∞–∂–¥–æ–≥–æ wealth_segment –Ω–∞—Ö–æ–¥–∏—Ç 5 –∫–ª–∏–µ–Ω—Ç–æ–≤ —Å –Ω–∞–∏–±–æ–ª—å—à–∏–º –¥–æ—Ö–æ–¥–æ–º
-- –†–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç revenue_generated –∫–∞–∫ —Å—É–º–º—É –ø–æ–∫—É–ø–æ–∫
-- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: –∏–º—è, —Ñ–∞–º–∏–ª–∏—è, —Å–µ–≥–º–µ–Ω—Ç, –¥–æ—Ö–æ–¥, –ø–æ–∑–∏—Ü–∏—è –≤ —Ä–µ–π—Ç–∏–Ω–≥–µ
```
### 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤:
- –ü—Ä–æ–≤–µ—Ä–∫–∞, —á—Ç–æ –æ–±–∞ –∑–∞–ø—Ä–æ—Å–∞ –≤–µ—Ä–Ω—É–ª–∏ –Ω–µ–ø—É—Å—Ç—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã;

- –ï—Å–ª–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ø—É—Å—Ç–æ–π ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ email —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è.

## –°–∏—Å—Ç–µ–º–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
- –ü—Ä–∏ —É—Å–ø–µ—Ö–µ: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è "DAG –≤—ã–ø–æ–ª–Ω–µ–Ω —É—Å–ø–µ—à–Ω–æ!"

- –ü—Ä–∏ –æ—à–∏–±–∫–µ: –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ + –û—Ç–ø—Ä–∞–≤–∫–∞ email **(–∑–∞–≥–ª—É—à–∫–∞ –¥–ª—è –¥–µ–º–æ)**

## –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

<details>
<summary><b>–°–≤–µ–¥–µ–Ω–∏—è –æ DAG</b></summary>

<img src="airtifacts/–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ dag.png" alt="–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ dag" width="2000" height="1000">
</details>

<details>
<summary><b>–ñ–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª DAG</b></summary>

<img src="airtifacts/—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ dag.png" alt="–∂–∏–∑–Ω–µ–Ω–Ω—ã–π —Ü–∏–∫–ª dag" width="2000" height="1000">
</details>

<details>
<summary><b>–†–µ–∑—É–ª—å—Ç–∞—Ç –∑–∞–ø—É—Å–∫–∞ DAG</b></summary>

<img src="airtifacts/–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ dag.png" alt="–≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ dag" width="2000" height="1000">
</details>

Python-—Å–∫—Ä–∏–ø—Ç —Å DAG –ø—Ä–∏–≤–µ–¥–µ–Ω [–∑–¥–µ—Å—å](https://github.com/steishas/homework6mipt_apacheairflow/blob/main/python_scripts/%D0%A1%D0%BC%D0%B8%D1%80%D0%BD%D0%BE%D0%B2%D0%B0_%D0%90_%D0%9C.py)
